/*!
 * =============================================================
 * dropify v0.2.1 - Override your input files with style.
 * https://github.com/JeremyFagis/dropify
 *
 * (c) 2016 - Jeremy FAGIS <jeremy@fagis.fr> (http://fagis.fr)
 * =============================================================
 */ !function(b,a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a(require("jquery")):b.Dropify=a(b.jQuery)}(this,function(b){function a(a,c){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var d={defaultFile:"",maxFileSize:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,showRemove:!0,showLoader:!0,showErrors:!0,errorTimeout:3e3,errorsPosition:"overlay",imgFileExtensions:["png","jpg","jpeg","gif","bmp"],maxFileSizePreview:"5M",allowedFormats:["portrait","square","landscape"],allowedFileExtensions:["*"],messages:{default:"Drag and drop a file here or click",replace:"Drag and drop or click to replace",remove:"Remove",error:"Ooops, something wrong appended."},error:{fileSize:"The file size is too big ({{ value }} max).",minWidth:"The image width is too small ({{ value }}}px min).",maxWidth:"The image width is too big ({{ value }}}px max).",minHeight:"The image height is too small ({{ value }}}px min).",maxHeight:"The image height is too big ({{ value }}px max).",imageFormat:"The image format is not allowed ({{ value }} only).",fileExtension:"The file is not allowed ({{ value }} only)."},tpl:{wrap:'<div class="dropify-wrapper"></div>',loader:'<div class="dropify-loader"></div>',message:'<div class="dropify-message"><span class="file-icon" /> <span class="material-icons icon_upload">file_upload</span><p>{{ default }}</p></div>',preview:'<div class="dropify-preview"><span class="dropify-render"></span><div class="dropify-infos"><div class="dropify-infos-inner"><p class="dropify-infos-message">{{ replace }}</p></div></div></div>',filename:'<p class="dropify-filename"><span class="file-icon"></span> <span class="dropify-filename-inner"></span></p>',clearButton:'<button type="button" class="dropify-clear">{{ remove }}</button>',errorLine:'<p class="dropify-error">{{ error }}</p>',errorsContainer:'<div class="dropify-errors-container"><ul></ul></div>'}};this.element=a,this.input=b(this.element),this.wrapper=null,this.preview=null,this.filenameWrapper=null,this.settings=b.extend(!0,d,c,this.input.data()),this.errorsEvent=b.Event("dropify.errors"),this.isDisabled=!1,this.isInit=!1,this.file={object:null,name:null,size:null,width:null,height:null,type:null},Array.isArray(this.settings.allowedFormats)||(this.settings.allowedFormats=this.settings.allowedFormats.split(" ")),Array.isArray(this.settings.allowedFileExtensions)||(this.settings.allowedFileExtensions=this.settings.allowedFileExtensions.split(" ")),this.onChange=this.onChange.bind(this),this.clearElement=this.clearElement.bind(this),this.onFileReady=this.onFileReady.bind(this),this.translateMessages(),this.createElements(),this.setContainerSize(),this.errorsEvent.errors=[],this.input.on("change",this.onChange)}}var c="dropify";return a.prototype.onChange=function(){this.resetPreview(),this.readFile(this.element)},a.prototype.createElements=function(){this.isInit=!0,this.input.wrap(b(this.settings.tpl.wrap)),this.wrapper=this.input.parent();var c=b(this.settings.tpl.message).insertBefore(this.input);b(this.settings.tpl.errorLine).appendTo(c),!0===this.isTouchDevice()&&this.wrapper.addClass("touch-fallback"),this.input.attr("disabled")&&(this.isDisabled=!0,this.wrapper.addClass("disabled")),!0===this.settings.showLoader&&(this.loader=b(this.settings.tpl.loader),this.loader.insertBefore(this.input)),this.preview=b(this.settings.tpl.preview),this.preview.insertAfter(this.input),!1===this.isDisabled&& !0===this.settings.showRemove&&(this.clearButton=b(this.settings.tpl.clearButton),this.clearButton.insertAfter(this.input),this.clearButton.on("click",this.clearElement)),this.filenameWrapper=b(this.settings.tpl.filename),this.filenameWrapper.prependTo(this.preview.find(".dropify-infos-inner")),!0===this.settings.showErrors&&(this.errorsContainer=b(this.settings.tpl.errorsContainer),"outside"===this.settings.errorsPosition?this.errorsContainer.insertAfter(this.wrapper):this.errorsContainer.insertBefore(this.input));var a=this.settings.defaultFile||"";""!==a.trim()&&(this.file.name=this.cleanFilename(a),this.setPreview(this.isImage(),a))},a.prototype.readFile=function(a){if(a.files&&a.files[0]){var c=new FileReader,e=new Image,d=a.files[0],f=null,g=this,h=b.Event("dropify.fileReady");this.clearErrors(),this.showLoader(),this.setFileInformations(d),this.errorsEvent.errors=[],this.checkFileSize(),this.isFileExtensionAllowed(),this.isImage()&&this.file.size<this.sizeToByte(this.settings.maxFileSizePreview)?(this.input.on("dropify.fileReady",this.onFileReady),c.readAsDataURL(d),c.onload=(function(a){f=a.target.result,e.src=a.target.result,e.onload=function(){g.setFileDimensions(this.width,this.height),g.validateImage(),g.input.trigger(h,[!0,f])}}).bind(this)):this.onFileReady(!1)}},a.prototype.onFileReady=function(e,b,c){if(this.input.off("dropify.fileReady",this.onFileReady),0===this.errorsEvent.errors.length)this.setPreview(b,c);else{this.input.trigger(this.errorsEvent,[this]);for(var a=this.errorsEvent.errors.length-1;a>=0;a--){var d=this.errorsEvent.errors[a].namespace.split(".").pop();this.showError(d)}if(void 0!==this.errorsContainer){this.errorsContainer.addClass("visible");var f=this.errorsContainer;setTimeout(function(){f.removeClass("visible")},this.settings.errorTimeout)}this.wrapper.addClass("has-error"),this.resetPreview(),this.clearElement()}},a.prototype.setFileInformations=function(a){this.file.object=a,this.file.name=a.name,this.file.size=a.size,this.file.type=a.type,this.file.width=null,this.file.height=null},a.prototype.setFileDimensions=function(a,b){this.file.width=a,this.file.height=b},a.prototype.setPreview=function(d,e){this.wrapper.removeClass("has-error").addClass("has-preview"),this.filenameWrapper.children(".dropify-filename-inner").html(this.file.name);var a=this.preview.children(".dropify-render");if(this.hideLoader(),!0===d){var c=b("<img />").attr("src",e);this.settings.height&&c.css("max-height",this.settings.height),c.appendTo(a)}else b("<i />").attr("class","dropify-font-file").appendTo(a),b('<span class="dropify-extension" />').html(this.getFileType()).appendTo(a);this.preview.fadeIn()},a.prototype.resetPreview=function(){this.wrapper.removeClass("has-preview");var a=this.preview.children(".dropify-render");a.find(".dropify-extension").remove(),a.find("i").remove(),a.find("img").remove(),this.preview.hide(),this.hideLoader()},a.prototype.cleanFilename=function(a){var b=a.split("\\").pop();return b==a&&(b=a.split("/").pop()),""!==a?b:""},a.prototype.clearElement=function(){if(0===this.errorsEvent.errors.length){var a=b.Event("dropify.beforeClear");this.input.trigger(a,[this]),!1!==a.result&&(this.resetFile(),this.input.val(""),this.resetPreview(),this.input.trigger(b.Event("dropify.afterClear"),[this]))}else this.resetFile(),this.input.val(""),this.resetPreview()},a.prototype.resetFile=function(){this.file.object=null,this.file.name=null,this.file.size=null,this.file.type=null,this.file.width=null,this.file.height=null},a.prototype.setContainerSize=function(){this.settings.height&&this.wrapper.height(this.settings.height)},a.prototype.isTouchDevice=function(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0},a.prototype.getFileType=function(){return this.file.name.split(".").pop().toLowerCase()},a.prototype.isImage=function(){return"-1"!=this.settings.imgFileExtensions.indexOf(this.getFileType())},a.prototype.isFileExtensionAllowed=function(){return"-1"!=this.settings.allowedFileExtensions.indexOf("*")||"-1"!=this.settings.allowedFileExtensions.indexOf(this.getFileType())||(this.pushError("fileExtension"),!1)},a.prototype.translateMessages=function(){for(var a in this.settings.tpl)for(var b in this.settings.messages)this.settings.tpl[a]=this.settings.tpl[a].replace("{{ "+b+" }}",this.settings.messages[b])},a.prototype.checkFileSize=function(){0!==this.sizeToByte(this.settings.maxFileSize)&&this.file.size>this.sizeToByte(this.settings.maxFileSize)&&this.pushError("fileSize")},a.prototype.sizeToByte=function(a){var b=0;if(0!==a){var c=a.slice(-1).toUpperCase(),d=1024,e=1024*d,f=1024*e;"K"===c?b=parseFloat(a)*d:"M"===c?b=parseFloat(a)*e:"G"===c&&(b=parseFloat(a)*f)}return b},a.prototype.validateImage=function(){0!==this.settings.minWidth&&this.settings.minWidth>=this.file.width&&this.pushError("minWidth"),0!==this.settings.maxWidth&&this.settings.maxWidth<=this.file.width&&this.pushError("maxWidth"),0!==this.settings.minHeight&&this.settings.minHeight>=this.file.height&&this.pushError("minHeight"),0!==this.settings.maxHeight&&this.settings.maxHeight<=this.file.height&&this.pushError("maxHeight"),"-1"==this.settings.allowedFormats.indexOf(this.getImageFormat())&&this.pushError("imageFormat")},a.prototype.getImageFormat=function(){return this.file.width==this.file.height?"square":this.file.width<this.file.height?"portrait":this.file.width>this.file.height?"landscape":void 0},a.prototype.pushError=function(c){var a=b.Event("dropify.error."+c);this.errorsEvent.errors.push(a),this.input.trigger(a,[this])},a.prototype.clearErrors=function(){void 0!==this.errorsContainer&&this.errorsContainer.children("ul").html("")},a.prototype.showError=function(a){void 0!==this.errorsContainer&&this.errorsContainer.children("ul").append("<li>"+this.getError(a)+"</li>")},a.prototype.getError=function(b){var c=this.settings.error[b],a="";return"fileSize"===b?a=this.settings.maxFileSize:"minWidth"===b?a=this.settings.minWidth:"maxWidth"===b?a=this.settings.maxWidth:"minHeight"===b?a=this.settings.minHeight:"maxHeight"===b?a=this.settings.maxHeight:"imageFormat"===b?a=this.settings.allowedFormats.join(", "):"fileExtension"===b&&(a=this.settings.allowedFileExtensions.join(", ")),""!==a?c.replace("{{ value }}",a):c},a.prototype.showLoader=function(){void 0!==this.loader&&this.loader.show()},a.prototype.hideLoader=function(){void 0!==this.loader&&this.loader.hide()},a.prototype.destroy=function(){this.input.siblings().remove(),this.input.unwrap(),this.isInit=!1},a.prototype.init=function(){this.createElements()},a.prototype.isDropified=function(){return this.isInit},b.fn[c]=function(d){return this.each(function(){b.data(this,c)||b.data(this,c,new a(this,d))}),this},a})